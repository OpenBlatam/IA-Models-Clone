{
  "version": "002",
  "name": "Add Metrics Tables",
  "description": "Add tables for system metrics and monitoring",
  "migration_type": "create_table",
  "up_sql": "-- Create metrics table\nCREATE TABLE IF NOT EXISTS metrics (\n    id VARCHAR(255) PRIMARY KEY,\n    name VARCHAR(255) NOT NULL,\n    value DECIMAL(15,4) NOT NULL,\n    unit VARCHAR(50),\n    tags JSON,\n    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    metadata JSON\n);\n\n-- Create alerts table\nCREATE TABLE IF NOT EXISTS alerts (\n    id VARCHAR(255) PRIMARY KEY,\n    name VARCHAR(255) NOT NULL,\n    description TEXT,\n    condition TEXT NOT NULL,\n    threshold DECIMAL(15,4),\n    severity VARCHAR(50) NOT NULL,\n    is_active BOOLEAN DEFAULT TRUE,\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n\n-- Create alert_history table\nCREATE TABLE IF NOT EXISTS alert_history (\n    id VARCHAR(255) PRIMARY KEY,\n    alert_id VARCHAR(255) REFERENCES alerts(id) ON DELETE CASCADE,\n    status VARCHAR(50) NOT NULL,\n    value DECIMAL(15,4),\n    message TEXT,\n    triggered_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    resolved_at TIMESTAMP\n);\n\n-- Create integrations table\nCREATE TABLE IF NOT EXISTS integrations (\n    id VARCHAR(255) PRIMARY KEY,\n    name VARCHAR(255) NOT NULL,\n    type VARCHAR(100) NOT NULL,\n    configuration JSON NOT NULL,\n    is_active BOOLEAN DEFAULT TRUE,\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n\n-- Create ml_pipelines table\nCREATE TABLE IF NOT EXISTS ml_pipelines (\n    id VARCHAR(255) PRIMARY KEY,\n    name VARCHAR(255) NOT NULL,\n    description TEXT,\n    pipeline_config JSON NOT NULL,\n    status VARCHAR(50) DEFAULT 'draft',\n    version VARCHAR(50) DEFAULT '1.0.0',\n    created_by VARCHAR(255) REFERENCES users(id),\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n\n-- Create enhancement_requests table\nCREATE TABLE IF NOT EXISTS enhancement_requests (\n    id VARCHAR(255) PRIMARY KEY,\n    title VARCHAR(255) NOT NULL,\n    description TEXT NOT NULL,\n    request_type VARCHAR(100) NOT NULL,\n    priority VARCHAR(50) DEFAULT 'normal',\n    status VARCHAR(50) DEFAULT 'open',\n    requested_by VARCHAR(255) REFERENCES users(id),\n    assigned_to VARCHAR(255) REFERENCES users(id),\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n\n-- Create indexes for new tables\nCREATE INDEX IF NOT EXISTS idx_metrics_name ON metrics(name);\nCREATE INDEX IF NOT EXISTS idx_metrics_timestamp ON metrics(timestamp);\nCREATE INDEX IF NOT EXISTS idx_alerts_severity ON alerts(severity);\nCREATE INDEX IF NOT EXISTS idx_alerts_active ON alerts(is_active);\nCREATE INDEX IF NOT EXISTS idx_alert_history_alert ON alert_history(alert_id);\nCREATE INDEX IF NOT EXISTS idx_alert_history_status ON alert_history(status);\nCREATE INDEX IF NOT EXISTS idx_alert_history_triggered ON alert_history(triggered_at);\nCREATE INDEX IF NOT EXISTS idx_integrations_type ON integrations(type);\nCREATE INDEX IF NOT EXISTS idx_integrations_active ON integrations(is_active);\nCREATE INDEX IF NOT EXISTS idx_ml_pipelines_status ON ml_pipelines(status);\nCREATE INDEX IF NOT EXISTS idx_enhancement_requests_type ON enhancement_requests(request_type);\nCREATE INDEX IF NOT EXISTS idx_enhancement_requests_status ON enhancement_requests(status);\nCREATE INDEX IF NOT EXISTS idx_enhancement_requests_priority ON enhancement_requests(priority);",
  "down_sql": "-- Drop indexes\nDROP INDEX IF EXISTS idx_enhancement_requests_priority;\nDROP INDEX IF EXISTS idx_enhancement_requests_status;\nDROP INDEX IF EXISTS idx_enhancement_requests_type;\nDROP INDEX IF EXISTS idx_ml_pipelines_status;\nDROP INDEX IF EXISTS idx_integrations_active;\nDROP INDEX IF EXISTS idx_integrations_type;\nDROP INDEX IF EXISTS idx_alert_history_triggered;\nDROP INDEX IF EXISTS idx_alert_history_status;\nDROP INDEX IF EXISTS idx_alert_history_alert;\nDROP INDEX IF EXISTS idx_alerts_active;\nDROP INDEX IF EXISTS idx_alerts_severity;\nDROP INDEX IF EXISTS idx_metrics_timestamp;\nDROP INDEX IF EXISTS idx_metrics_name;\n\n-- Drop tables\nDROP TABLE IF EXISTS enhancement_requests;\nDROP TABLE IF EXISTS ml_pipelines;\nDROP TABLE IF EXISTS integrations;\nDROP TABLE IF EXISTS alert_history;\nDROP TABLE IF EXISTS alerts;\nDROP TABLE IF EXISTS metrics;",
  "dependencies": ["001"],
  "metadata": {
    "author": "system",
    "tags": ["metrics", "monitoring", "alerts"]
  }
}
