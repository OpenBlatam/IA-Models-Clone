{
  "version": "001",
  "name": "Initial Schema",
  "description": "Create initial database schema for business agents system",
  "migration_type": "create_table",
  "up_sql": "-- Create users table\nCREATE TABLE IF NOT EXISTS users (\n    id VARCHAR(255) PRIMARY KEY,\n    username VARCHAR(100) UNIQUE NOT NULL,\n    email VARCHAR(255) UNIQUE NOT NULL,\n    full_name VARCHAR(255) NOT NULL,\n    is_active BOOLEAN DEFAULT TRUE,\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n\n-- Create roles table\nCREATE TABLE IF NOT EXISTS roles (\n    id VARCHAR(255) PRIMARY KEY,\n    name VARCHAR(100) UNIQUE NOT NULL,\n    description TEXT,\n    permissions JSON,\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n\n-- Create user_roles table\nCREATE TABLE IF NOT EXISTS user_roles (\n    user_id VARCHAR(255) REFERENCES users(id) ON DELETE CASCADE,\n    role_id VARCHAR(255) REFERENCES roles(id) ON DELETE CASCADE,\n    assigned_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    PRIMARY KEY (user_id, role_id)\n);\n\n-- Create business_agents table\nCREATE TABLE IF NOT EXISTS business_agents (\n    id VARCHAR(255) PRIMARY KEY,\n    name VARCHAR(255) NOT NULL,\n    business_area VARCHAR(100) NOT NULL,\n    description TEXT,\n    capabilities JSON,\n    is_active BOOLEAN DEFAULT TRUE,\n    metadata JSON,\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n\n-- Create workflows table\nCREATE TABLE IF NOT EXISTS workflows (\n    id VARCHAR(255) PRIMARY KEY,\n    name VARCHAR(255) NOT NULL,\n    description TEXT,\n    business_area VARCHAR(100) NOT NULL,\n    steps JSON NOT NULL,\n    variables JSON,\n    status VARCHAR(50) DEFAULT 'draft',\n    created_by VARCHAR(255) REFERENCES users(id),\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n\n-- Create workflow_executions table\nCREATE TABLE IF NOT EXISTS workflow_executions (\n    id VARCHAR(255) PRIMARY KEY,\n    workflow_id VARCHAR(255) REFERENCES workflows(id) ON DELETE CASCADE,\n    status VARCHAR(50) NOT NULL,\n    input_data JSON,\n    output_data JSON,\n    started_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    completed_at TIMESTAMP,\n    error_message TEXT\n);\n\n-- Create documents table\nCREATE TABLE IF NOT EXISTS documents (\n    id VARCHAR(255) PRIMARY KEY,\n    title VARCHAR(255) NOT NULL,\n    document_type VARCHAR(100) NOT NULL,\n    format VARCHAR(50) NOT NULL,\n    content TEXT,\n    file_path VARCHAR(500),\n    business_area VARCHAR(100),\n    created_by VARCHAR(255) REFERENCES users(id),\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    metadata JSON\n);\n\n-- Create notifications table\nCREATE TABLE IF NOT EXISTS notifications (\n    id VARCHAR(255) PRIMARY KEY,\n    user_id VARCHAR(255) REFERENCES users(id) ON DELETE CASCADE,\n    title VARCHAR(255) NOT NULL,\n    message TEXT NOT NULL,\n    type VARCHAR(50) NOT NULL,\n    is_read BOOLEAN DEFAULT FALSE,\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n\n-- Create indexes\nCREATE INDEX IF NOT EXISTS idx_users_email ON users(email);\nCREATE INDEX IF NOT EXISTS idx_users_username ON users(username);\nCREATE INDEX IF NOT EXISTS idx_business_agents_area ON business_agents(business_area);\nCREATE INDEX IF NOT EXISTS idx_workflows_area ON workflows(business_area);\nCREATE INDEX IF NOT EXISTS idx_workflows_status ON workflows(status);\nCREATE INDEX IF NOT EXISTS idx_workflow_executions_workflow ON workflow_executions(workflow_id);\nCREATE INDEX IF NOT EXISTS idx_workflow_executions_status ON workflow_executions(status);\nCREATE INDEX IF NOT EXISTS idx_documents_type ON documents(document_type);\nCREATE INDEX IF NOT EXISTS idx_documents_area ON documents(business_area);\nCREATE INDEX IF NOT EXISTS idx_notifications_user ON notifications(user_id);\nCREATE INDEX IF NOT EXISTS idx_notifications_read ON notifications(is_read);",
  "down_sql": "-- Drop indexes\nDROP INDEX IF EXISTS idx_notifications_read;\nDROP INDEX IF EXISTS idx_notifications_user;\nDROP INDEX IF EXISTS idx_documents_area;\nDROP INDEX IF EXISTS idx_documents_type;\nDROP INDEX IF EXISTS idx_workflow_executions_status;\nDROP INDEX IF EXISTS idx_workflow_executions_workflow;\nDROP INDEX IF EXISTS idx_workflows_status;\nDROP INDEX IF EXISTS idx_workflows_area;\nDROP INDEX IF EXISTS idx_business_agents_area;\nDROP INDEX IF EXISTS idx_users_username;\nDROP INDEX IF EXISTS idx_users_email;\n\n-- Drop tables\nDROP TABLE IF EXISTS notifications;\nDROP TABLE IF EXISTS documents;\nDROP TABLE IF EXISTS workflow_executions;\nDROP TABLE IF EXISTS workflows;\nDROP TABLE IF EXISTS business_agents;\nDROP TABLE IF EXISTS user_roles;\nDROP TABLE IF EXISTS roles;\nDROP TABLE IF EXISTS users;",
  "dependencies": [],
  "metadata": {
    "author": "system",
    "tags": ["initial", "schema", "tables"]
  }
}
