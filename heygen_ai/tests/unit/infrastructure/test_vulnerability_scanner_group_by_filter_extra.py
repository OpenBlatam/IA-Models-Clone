from vulnerability_scanner import WebVulnerabilityScanner, VulnerabilityFinding, VulnerabilitySeverity


def test_group_by_and_filter_by_severity_combined():
    s = WebVulnerabilityScanner()
    findings = [
        VulnerabilityFinding(vulnerability_type='x', severity_level=VulnerabilitySeverity.LOW, description='d', target_url='u'),
        VulnerabilityFinding(vulnerability_type='x', severity_level=VulnerabilitySeverity.HIGH, description='d', target_url='u', is_exploitable=True),
        VulnerabilityFinding(vulnerability_type='y', severity_level=VulnerabilitySeverity.CRITICAL, description='d', target_url='u'),
    ]
    grouped = s.group_by_vulnerability_type(findings)
    assert set(grouped.keys()) == {'x', 'y'}
    filtered = s.filter_by_severity(findings, VulnerabilitySeverity.HIGH)
    assert all(f.severity_level in {VulnerabilitySeverity.HIGH, VulnerabilitySeverity.CRITICAL} for f in filtered)


