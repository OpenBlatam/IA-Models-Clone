import pytest

from vulnerability_scanner import WebVulnerabilityScanner


@pytest.mark.asyncio
async def test_headers_weak_values_detected():
    s = WebVulnerabilityScanner()
    headers = {
        'X-Frame-Options': 'ALLOW',  # weak
        'X-Content-Type-Options': 'sniff',  # weak
        'Strict-Transport-Security': 'max-age=1',  # weak
        'Content-Security-Policy': "default-src *",  # weak
    }
    findings = await s._check_security_headers('http://weak.test/', headers)
    assert any(f.vulnerability_type in {'weak_security_header', 'missing_security_header'} for f in findings)


