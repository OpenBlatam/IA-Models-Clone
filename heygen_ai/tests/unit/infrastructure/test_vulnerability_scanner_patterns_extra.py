import pytest

from vulnerability_scanner import WebVulnerabilityScanner, VulnerabilityFinding


@pytest.mark.asyncio
async def test_scan_content_patterns_detects_sql_and_xss():
    s = WebVulnerabilityScanner()
    content_sql = "user input: 1' OR 1=1--"
    content_xss = '<script>alert("x")</script>'

    res_sql = await s._scan_content_patterns('http://t/', content_sql)
    res_xss = await s._scan_content_patterns('http://t/', content_xss)

    assert any(isinstance(f, VulnerabilityFinding) and f.vulnerability_type == 'sql_injection' for f in res_sql)
    assert any(isinstance(f, VulnerabilityFinding) and f.vulnerability_type == 'cross_site_scripting' for f in res_xss)


