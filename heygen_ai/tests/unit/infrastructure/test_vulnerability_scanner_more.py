import pytest

from vulnerability_scanner import (
    WebVulnerabilityScanner,
    VulnerabilitySeverity,
)


@pytest.mark.asyncio
async def test_scan_multiple_urls_groups_results(monkeypatch):
    async def fake_scan_single_url(self, url):
        if "http://" in url:
            return await self._check_https_usage(url)
        return []

    monkeypatch.setattr(WebVulnerabilityScanner, "scan_single_url", fake_scan_single_url)

    scanner = WebVulnerabilityScanner()
    urls = [
        "https://secure.example.com",
        "http://insecure.example.com",
    ]
    results = await scanner.scan_multiple_urls(urls)

    assert set(results.keys()) == set(urls)
    assert len(results["https://secure.example.com"]) == 0
    assert len(results["http://insecure.example.com"]) == 1
    assert results["http://insecure.example.com"][0].severity_level == VulnerabilitySeverity.HIGH













