from vulnerability_scanner import (
    WebVulnerabilityScanner,
    VulnerabilityFinding,
    VulnerabilitySeverity,
)


def test_filter_by_severity_and_group_by_type():
    scanner = WebVulnerabilityScanner()
    findings = [
        VulnerabilityFinding('xss', VulnerabilitySeverity.HIGH, 'x', 'u'),
        VulnerabilityFinding('sql_injection', VulnerabilitySeverity.CRITICAL, 's', 'u'),
        VulnerabilityFinding('missing_security_header', VulnerabilitySeverity.LOW, 'm', 'u'),
    ]

    filtered = scanner.filter_by_severity(findings, VulnerabilitySeverity.HIGH)
    assert all(f.severity_level in {VulnerabilitySeverity.HIGH, VulnerabilitySeverity.CRITICAL} for f in filtered)

    grouped = scanner.group_by_vulnerability_type(filtered)
    assert set(grouped.keys()) >= {'xss', 'sql_injection'}













